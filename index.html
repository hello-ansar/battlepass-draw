<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–†–æ–∑—ã–≥—Ä—ã—à Battle Pass</title>
  <style>
    :root{
      --bg1:#070A12; --bg2:#12182A;
      --card:#0F1424cc; --stroke:#ffffff1a;
      --text:#EAF0FF; --muted:#A9B3CF;
      --accent:#FF5E7A; --accent2:#7C5CFF;
      --good:#5CFFB3;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(1200px 600px at 20% 10%, #7c5cff33, transparent 60%),
        radial-gradient(900px 500px at 80% 20%, #ff5e7a26, transparent 60%),
        radial-gradient(900px 700px at 50% 95%, #5cffb31a, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .wrap{
      width:min(1100px, 100%);
      display:grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap:20px;
    }
    @media (max-width: 900px){
      .wrap{grid-template-columns:1fr; }
    }
    .panel{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius:22px;
      box-shadow: 0 30px 80px #00000066;
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }

    .header{
      padding:22px 22px 16px 22px;
      border-bottom:1px solid var(--stroke);
      position:relative;
      z-index:1;
    }
    .title{
      font-size:28px; font-weight:800; letter-spacing:0.2px;
      margin:0 0 6px;
    }
    .subtitle{
      margin:0; color:var(--muted); line-height:1.4;
      font-size:14px;
    }
    .content{ padding:22px; position:relative; z-index:1; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }

    .btn{
      appearance:none; border:1px solid var(--stroke);
      background: linear-gradient(180deg, #ffffff10, #ffffff06);
      color:var(--text);
      padding:12px 14px; border-radius:14px;
      font-weight:700; cursor:pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:hover{ border-color:#ffffff33; background: linear-gradient(180deg, #ffffff18, #ffffff08); }
    .btn:active{ transform: translateY(1px) scale(0.99); }
    .btn.primary{
      border-color: transparent;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 18px 45px #7c5cff2e, 0 18px 45px #ff5e7a20;
    }
    .btn.primary:hover{ filter:saturate(1.1) brightness(1.05); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    .hint{ color:var(--muted); font-size:13px; }
    .list{
      margin-top:14px;
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      background:#ffffff0a;
      border:1px solid var(--stroke);
      font-size:13px;
      color:#D9E2FF;
    }

    /* Wheel */
    .wheelWrap{
      display:flex; align-items:center; justify-content:center;
      padding:22px;
    }
    canvas{
      width:min(520px, 100%);
      aspect-ratio:1 / 1;
      height:auto;
      display:block;
      border-radius:999px;
    }
    .pointer{
      position:absolute;
      width:0; height:0;
      border-left:14px solid transparent;
      border-right:14px solid transparent;
      border-bottom:26px solid var(--accent);
      top:12px; left:50%;
      transform:translateX(-50%);
      filter: drop-shadow(0 8px 10px #00000080);
      z-index:2;
    }
    .wheelBox{
      position:relative;
      display:grid;
      place-items:center;
      padding:22px;
    }

    /* Winner modal */
    .modal{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      padding:22px;
      background:#00000090;
      backdrop-filter: blur(8px);
      z-index:10;
    }
    .modal.show{ display:flex; }
    .modalCard{
      width:min(720px, 100%);
      border-radius:26px;
      border:1px solid #ffffff22;
      background: radial-gradient(700px 260px at 50% 0%, #7c5cff30, transparent 60%),
                  radial-gradient(600px 240px at 30% 10%, #ff5e7a22, transparent 60%),
                  linear-gradient(180deg, #0e1324, #0a0f1d);
      box-shadow: 0 40px 120px #000000aa;
      padding:26px;
      position:relative;
      overflow:hidden;
    }
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background:#ffffff0f;
      border:1px solid #ffffff1f;
      color:var(--muted);
      font-weight:700;
      font-size:13px;
    }
    .winnerName{
      margin:14px 0 6px;
      font-size:48px;
      font-weight:900;
      letter-spacing:.3px;
      line-height:1.02;
      background: linear-gradient(135deg, #ffffff, #cfe0ff, #ffd1db);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-shadow: 0 20px 60px #00000055;
      word-break: break-word;
    }
    .winnerText{
      margin:0 0 16px;
      color:var(--muted);
      font-size:15px;
      line-height:1.5;
    }
    .modalActions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:14px;
    }
    .closeX{
      position:absolute; top:14px; right:14px;
      width:38px; height:38px;
      border-radius:12px;
      border:1px solid #ffffff22;
      background:#ffffff0a;
      color:var(--text);
      cursor:pointer;
      font-weight:900;
    }
    .closeX:hover{ background:#ffffff12; }

    /* Confetti canvas */
    #confetti{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:11;
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <div class="wrap">
    <div class="panel">
      <div class="header">
        <h1 class="title">üéÅ –†–æ–∑—ã–≥—Ä—ã—à Battle Pass –≤ Will of Salem</h1>
        <p class="subtitle">–ö—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ</p>
      </div>

      <div class="wheelWrap">
        <div class="wheelBox">
          <div class="pointer"></div>
          <canvas id="wheel" width="900" height="900"></canvas>
        </div>
      </div>

      <div class="content">
        <div class="row">
            <button id="spinBtn" class="btn primary">–ö—Ä—É—Ç–∏—Ç—å (–≤—ã–±—ã–≤–∞–Ω–∏–µ)</button>
            <button id="undoBtn" class="btn" disabled>–í–µ—Ä–Ω—É—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ</button>
            <button id="resetBtn" class="btn">–°–±—Ä–æ—Å</button>
            <button id="reshuffleBtn" class="btn">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å —Ü–≤–µ—Ç–∞</button>
            <span class="hint" id="status">–ì–æ—Ç–æ–≤–æ.</span>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="header">
        <h2 class="title" style="font-size:22px;margin:0 0 6px;">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
        <p class="subtitle">–°–ø–∏—Å–æ–∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —á–µ—Å—Ç–Ω–æ (—Ä–∞–Ω–¥–æ–º).</p>
      </div>
      <div class="content">
        <div class="list" id="chips"></div>
        <p class="hint" style="margin-top:14px;">
          by Yeshkenbay Angsar
        </p>
      </div>
    </div>
  </div>

  <!-- Winner modal -->
  <div class="modal" id="modal">
    <div class="modalCard">
      <button class="closeX" id="closeModal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <div class="badge">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –≤—ã–±—Ä–∞–Ω</div>
      <div class="winnerName" id="winnerName">‚Äî</div>
      <p class="winnerText" id="winnerText">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ</p>
      <div class="modalActions">
        <button class="btn primary" id="spinAgain">–ö—Ä—É—Ç–∏—Ç—å –µ—â—ë —Ä–∞–∑</button>
        <button class="btn" id="copyWinner">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∏–∫</button>
      </div>
    </div>
  </div>

  <script>
  // ----------------------------
  // Data (–∏—Å—Ö–æ–¥–Ω—ã–π —Å–ø–∏—Å–æ–∫)
  // ----------------------------
  const initialParticipants = [
    "LOGAN","Denis","Ricardo-Milo$$$","Postal","Angsar","–§—ë–¥–æ—Ä–æ–≤ –°–µ—Ä–≥–µ–π","Samurai","Vag—ër",
    "–í–∏–∫—Ç–æ—Ä–∏—è","MARSHMALLOWS","–ö–æ—Ç –ë–µ–≥–µ–º–æ—Ç","Golovorez","DenZilla","Laud","kkkk"
  ];

  // —Ä–∞–±–æ—á–∏–π —Å–ø–∏—Å–æ–∫ (–±—É–¥–µ–º —É–¥–∞–ª—è—Ç—å)
  let participants = [...initialParticipants];
  let eliminatedStack = []; // –¥–ª—è "–≤–µ—Ä–Ω—É—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ"

  // Render participant chips
  const chips = document.getElementById('chips');
  function renderChips(){
    chips.innerHTML = "";
    participants.forEach(n => {
      const span = document.createElement('span');
      span.className = 'chip';
      span.textContent = n;
      chips.appendChild(span);
    });
  }
  renderChips();

  // ----------------------------
  // Wheel drawing
  // ----------------------------
  const canvas = document.getElementById('wheel');
  const ctx = canvas.getContext('2d');

  const W = canvas.width;
  const H = canvas.height;
  const cx = W/2, cy = H/2;
  const radius = Math.min(W, H) * 0.42;

  let angle = Math.random() * Math.PI * 2;
  let paletteSeed = Math.random() * 1000;

  function hsl(i, n){
    const hue = ((i / n) * 360 + paletteSeed) % 360;
    return `hsl(${hue} 85% 55%)`;
  }

  function fitLabel(text, maxChars){
    if (text.length <= maxChars) return text;
    return text.slice(0, Math.max(1, maxChars - 1)).trim() + "‚Ä¶";
  }

  function drawWheel(){
    ctx.clearRect(0,0,W,H);

    // empty state
    if (participants.length === 0){
      ctx.save();
      ctx.translate(cx, cy);
      ctx.fillStyle = "rgba(255,255,255,0.85)";
      ctx.font = "900 34px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤", 0, 0);
      ctx.restore();
      return;
    }

    // shadow + ring
    ctx.save();
    ctx.translate(cx, cy);
    ctx.beginPath();
    ctx.arc(0, 10, radius + 26, 0, Math.PI*2);
    ctx.fillStyle = "rgba(0,0,0,0.55)";
    ctx.fill();
    ctx.restore();

    // outer ring
    ctx.save();
    ctx.translate(cx, cy);
    ctx.beginPath();
    ctx.arc(0, 0, radius + 18, 0, Math.PI*2);
    ctx.fillStyle = "#23283b";
    ctx.fill();
    ctx.beginPath();
    ctx.arc(0, 0, radius + 10, 0, Math.PI*2);
    ctx.fillStyle = "#11162a";
    ctx.fill();
    ctx.restore();

    const n = participants.length;
    const step = (Math.PI*2)/n;

    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(angle);

    for(let i=0;i<n;i++){
      const start = -Math.PI/2 + i*step;
      const end = start + step;

      // sector
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0,radius,start,end);
      ctx.closePath();
      ctx.fillStyle = hsl(i,n);
      ctx.fill();

      ctx.strokeStyle = "rgba(0,0,0,0.25)";
      ctx.lineWidth = 3;
      ctx.stroke();

      // label (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ —É —Ç–µ–±—è: –ø–æ –∫–∞—Å–∞—Ç–µ–ª—å–Ω–æ–π)
      const mid = (start+end)/2;
      ctx.save();
      ctx.rotate(mid);

      const name = participants[i];
      const label = fitLabel(name, 14);

      // –∞–≤—Ç–æ-—É–º–µ–Ω—å—à–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞ (—á—Ç–æ–±—ã –Ω–µ "–ª–æ–º–∞–ª–æ—Å—å")
      let fontSize = 26;
      if (name.length > 12) fontSize = 22;
      if (name.length > 14) fontSize = 20;
      if (name.length > 16) fontSize = 18;

      ctx.font = `900 ${fontSize}px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.translate(radius*0.70, 0);

      ctx.rotate(Math.PI/2);

      // —Ç–µ–Ω—å + —Ç–µ–∫—Å—Ç
      ctx.fillStyle = "rgba(0,0,0,0.55)";
      ctx.fillText(label, 2, 2);
      ctx.fillStyle = "rgba(0,0,0,0.75)";
      ctx.fillText(label, 0, 0);

      ctx.restore();
    }
    ctx.restore();

    // hub
    ctx.save();
    ctx.translate(cx, cy);
    ctx.beginPath();
    ctx.arc(0,0,30,0,Math.PI*2);
    ctx.fillStyle="#0f1324";
    ctx.fill();
    ctx.beginPath();
    ctx.arc(0,0,12,0,Math.PI*2);
    ctx.fillStyle="#f2f4ff";
    ctx.fill();
    ctx.restore();
  }

  drawWheel();

  // ----------------------------
  // Spin logic (–≤—ã–±—ã–≤–∞–Ω–∏–µ)
  // ----------------------------
  const spinBtn = document.getElementById('spinBtn');
  const reshuffleBtn = document.getElementById('reshuffleBtn');
  const statusEl = document.getElementById('status');
  const undoBtn = document.getElementById('undoBtn');
  const resetBtn = document.getElementById('resetBtn');

  const modal = document.getElementById('modal');
  const winnerName = document.getElementById('winnerName');
  const winnerText = document.getElementById('winnerText');
  const closeModal = document.getElementById('closeModal');
  const spinAgain = document.getElementById('spinAgain');
  const copyWinner = document.getElementById('copyWinner');

  let spinning = false;
  let lastWinner = null;

  function easeOutCubic(t){ return 1 - Math.pow(1-t, 3); }

  function pickIndex(){
    return Math.floor(Math.random() * participants.length);
  }

  function targetAngleForIndex(index){
    const n = participants.length;
    const step = (Math.PI*2)/n;
    const sectorCenter = (-Math.PI/2) + index*step + step/2;
    const base = (-Math.PI/2) - sectorCenter;
    const turns = 7 + Math.floor(Math.random()*6); // 7..12 (—á—É—Ç—å –±—ã—Å—Ç—Ä–µ–µ)
    return base + turns * Math.PI * 2;
  }

  function openModal(title, text){
    winnerName.textContent = title;
    winnerText.textContent = text;
    modal.classList.add('show');
  }

  function closeWinner(){ modal.classList.remove('show'); }

  function updateButtons(){
    undoBtn.disabled = eliminatedStack.length === 0 || spinning;
    spinBtn.disabled = spinning || participants.length <= 1; // –∫–æ–≥–¥–∞ 1 –æ—Å—Ç–∞–ª—Å—è ‚Äî —É–∂–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
  }

  function finalizeIfOneLeft(){
    if (participants.length === 1){
      const champ = participants[0];
      lastWinner = champ;
      statusEl.textContent = `–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${champ}`;
      openModal(champ, "üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å! –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ");
      startConfetti(2200);
      updateButtons();
      return true;
    }
    return false;
  }

  function eliminateFlow(){
    if (spinning) return;
    if (participants.length <= 1){
      finalizeIfOneLeft();
      return;
    }

    spinning = true;
    updateButtons();
    reshuffleBtn.disabled = true;
    resetBtn.disabled = true;
    statusEl.textContent = "–ö—Ä—É—Ç–∏–º‚Ä¶";

    const idx = pickIndex();
    const pickedName = participants[idx];

    const start = angle;
    const end = targetAngleForIndex(idx);
    const duration = 5200;
    const startTime = performance.now();

    function frame(now){
      const t = Math.min(1, (now - startTime)/duration);
      const e = easeOutCubic(t);
      angle = start + (end - start) * e;
      drawWheel();

      if (t < 1){
        requestAnimationFrame(frame);
      } else {
        // –≤—ã–±—ã–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π
        eliminatedStack.push(pickedName);
        participants.splice(idx, 1);

        // —á—É—Ç—å ‚Äú—Ä–∞–Ω–¥–æ–º–∏–º‚Äù —É–≥–æ–ª —á—Ç–æ–±—ã –Ω–µ —Å—Ç–æ—è–ª–æ –∏–¥–µ–∞–ª—å–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
        angle = angle % (Math.PI*2);

        renderChips();
        drawWheel();

        spinning = false;
        reshuffleBtn.disabled = false;
        resetBtn.disabled = false;

        statusEl.textContent = `–í—ã–±—ã–ª: ${pickedName}. –û—Å—Ç–∞–ª–æ—Å—å: ${participants.length}`;
        openModal(pickedName, `‚ùå –í—ã–±—ã–ª –∏–∑ —Ä–æ–∑—ã–≥—Ä—ã—à–∞. –û—Å—Ç–∞–ª–æ—Å—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${participants.length}`);

        updateButtons();

        // –µ—Å–ª–∏ –æ—Å—Ç–∞–ª—Å—è 1 ‚Äî –æ–Ω –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
        finalizeIfOneLeft();
      }
    }

    requestAnimationFrame(frame);
  }

  spinBtn.addEventListener('click', eliminateFlow);

  reshuffleBtn.addEventListener('click', () => {
    paletteSeed = Math.random()*1000;
    drawWheel();
  });

  undoBtn.addEventListener('click', () => {
    if (spinning) return;
    const last = eliminatedStack.pop();
    if (!last) return;
    participants.push(last);
    renderChips();
    drawWheel();
    statusEl.textContent = `–í–µ—Ä–Ω—É–ª–∏: ${last}. –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${participants.length}`;
    updateButtons();
  });

  resetBtn.addEventListener('click', () => {
    if (spinning) return;
    participants = [...initialParticipants];
    eliminatedStack = [];
    angle = Math.random() * Math.PI * 2;
    renderChips();
    drawWheel();
    statusEl.textContent = "–°–±—Ä–æ—Å. –ì–æ—Ç–æ–≤–æ.";
    updateButtons();
  });

  // Modal controls
  closeModal.addEventListener('click', closeWinner);
  modal.addEventListener('click', (e) => { if(e.target === modal) closeWinner(); });

  spinAgain.addEventListener('click', () => {
    closeWinner();
    eliminateFlow();
  });

  copyWinner.addEventListener('click', async () => {
    // –≤ —Ä–µ–∂–∏–º–µ –≤—ã–±—ã–≤–∞–Ω–∏—è –∫–æ–ø–∏—Ä—É–µ–º –ª–∏–±–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è (–µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å), –ª–∏–±–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–±—ã–≤—à–µ–µ –∏–º—è (—á—Ç–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ)
    const text = (participants.length === 1) ? participants[0] : winnerName.textContent;
    if(!text || text === "‚Äî") return;

    try{
      await navigator.clipboard.writeText(text);
      copyWinner.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ";
      setTimeout(() => copyWinner.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∏–∫", 1200);
    }catch{
      copyWinner.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å üòÖ";
      setTimeout(() => copyWinner.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∏–∫", 1200);
    }
  });

  updateButtons();

  // ----------------------------
  // Confetti (lightweight)
  // ----------------------------
  const conf = document.getElementById('confetti');
  const cctx = conf.getContext('2d');
  let confetti = [];

  function resizeConf(){
    conf.width = window.innerWidth * devicePixelRatio;
    conf.height = window.innerHeight * devicePixelRatio;
  }
  window.addEventListener('resize', resizeConf);
  resizeConf();

  function startConfetti(ms=1500){
    const count = 240;
    confetti = [];
    for(let i=0;i<count;i++){
      confetti.push({
        x: Math.random()*conf.width,
        y: -20 - Math.random()*conf.height*0.3,
        vx: (Math.random()-0.5)*2.2,
        vy: 2 + Math.random()*5.0,
        size: 6 + Math.random()*10,
        rot: Math.random()*Math.PI,
        vr: (Math.random()-0.5)*0.25,
        hue: Math.random()*360
      });
    }
    const start = performance.now();

    function tick(now){
      cctx.clearRect(0,0,conf.width,conf.height);
      confetti.forEach(p=>{
        p.x += p.vx * devicePixelRatio;
        p.y += p.vy * devicePixelRatio;
        p.rot += p.vr;

        cctx.save();
        cctx.translate(p.x, p.y);
        cctx.rotate(p.rot);
        cctx.fillStyle = `hsla(${p.hue} 90% 60% / 0.95)`;
        cctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.7);
        cctx.restore();
      });
      confetti = confetti.filter(p => p.y < conf.height + 60);

      if (now - start < ms && confetti.length){
        requestAnimationFrame(tick);
      } else {
        cctx.clearRect(0,0,conf.width,conf.height);
      }
    }
    requestAnimationFrame(tick);
  }
</script>

</body>
</html>
