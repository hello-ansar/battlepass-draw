<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–†–æ–∑—ã–≥—Ä—ã—à Battle Pass</title>
  <style>
    :root{
      --bg1:#070A12; --bg2:#12182A;
      --card:#0F1424cc; --stroke:#ffffff1a;
      --text:#EAF0FF; --muted:#A9B3CF;
      --accent:#FF5E7A; --accent2:#7C5CFF;
      --good:#5CFFB3;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(1200px 600px at 20% 10%, #7c5cff33, transparent 60%),
        radial-gradient(900px 500px at 80% 20%, #ff5e7a26, transparent 60%),
        radial-gradient(900px 700px at 50% 95%, #5cffb31a, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .wrap{
      width:min(1100px, 100%);
      display:grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap:20px;
    }
    @media (max-width: 900px){
      .wrap{grid-template-columns:1fr; }
    }
    .panel{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius:22px;
      box-shadow: 0 30px 80px #00000066;
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 240px at 30% 10%, #7c5cff22, transparent 60%),
                  radial-gradient(500px 220px at 70% 0%, #ff5e7a1f, transparent 60%);
      pointer-events:none;
    }
    .header{
      padding:22px 22px 16px 22px;
      border-bottom:1px solid var(--stroke);
      position:relative;
      z-index:1;
    }
    .title{
      font-size:28px; font-weight:800; letter-spacing:0.2px;
      margin:0 0 6px;
    }
    .subtitle{
      margin:0; color:var(--muted); line-height:1.4;
      font-size:14px;
    }
    .content{ padding:22px; position:relative; z-index:1; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }

    .btn{
      appearance:none; border:1px solid var(--stroke);
      background: linear-gradient(180deg, #ffffff10, #ffffff06);
      color:var(--text);
      padding:12px 14px; border-radius:14px;
      font-weight:700; cursor:pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:hover{ border-color:#ffffff33; background: linear-gradient(180deg, #ffffff18, #ffffff08); }
    .btn:active{ transform: translateY(1px) scale(0.99); }
    .btn.primary{
      border-color: transparent;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 18px 45px #7c5cff2e, 0 18px 45px #ff5e7a20;
    }
    .btn.primary:hover{ filter:saturate(1.1) brightness(1.05); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    .hint{ color:var(--muted); font-size:13px; }
    .list{
      margin-top:14px;
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      background:#ffffff0a;
      border:1px solid var(--stroke);
      font-size:13px;
      color:#D9E2FF;
    }

    /* Wheel */
    .wheelWrap{
      display:flex; align-items:center; justify-content:center;
      padding:22px;
    }
    canvas{
      width:min(520px, 100%);
      aspect-ratio:1 / 1;
      height:auto;
      display:block;
      border-radius:999px;
      background:#0b1020;
      box-shadow: 0 30px 80px #00000066;
    }
    .pointer{
      position:absolute;
      width:0; height:0;
      border-left:14px solid transparent;
      border-right:14px solid transparent;
      border-bottom:26px solid var(--accent);
      top:12px; left:50%;
      transform:translateX(-50%);
      filter: drop-shadow(0 8px 10px #00000080);
      z-index:2;
    }
    .wheelBox{
      position:relative;
      display:grid;
      place-items:center;
      padding:22px;
    }

    /* Winner modal */
    .modal{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      padding:22px;
      background:#00000090;
      backdrop-filter: blur(8px);
      z-index:10;
    }
    .modal.show{ display:flex; }
    .modalCard{
      width:min(720px, 100%);
      border-radius:26px;
      border:1px solid #ffffff22;
      background: radial-gradient(700px 260px at 50% 0%, #7c5cff30, transparent 60%),
                  radial-gradient(600px 240px at 30% 10%, #ff5e7a22, transparent 60%),
                  linear-gradient(180deg, #0e1324, #0a0f1d);
      box-shadow: 0 40px 120px #000000aa;
      padding:26px;
      position:relative;
      overflow:hidden;
    }
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background:#ffffff0f;
      border:1px solid #ffffff1f;
      color:var(--muted);
      font-weight:700;
      font-size:13px;
    }
    .winnerName{
      margin:14px 0 6px;
      font-size:48px;
      font-weight:900;
      letter-spacing:.3px;
      line-height:1.02;
      background: linear-gradient(135deg, #ffffff, #cfe0ff, #ffd1db);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-shadow: 0 20px 60px #00000055;
      word-break: break-word;
    }
    .winnerText{
      margin:0 0 16px;
      color:var(--muted);
      font-size:15px;
      line-height:1.5;
    }
    .modalActions{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-top:14px;
    }
    .closeX{
      position:absolute; top:14px; right:14px;
      width:38px; height:38px;
      border-radius:12px;
      border:1px solid #ffffff22;
      background:#ffffff0a;
      color:var(--text);
      cursor:pointer;
      font-weight:900;
    }
    .closeX:hover{ background:#ffffff12; }

    /* Confetti canvas */
    #confetti{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:11;
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <div class="wrap">
    <div class="panel">
      <div class="header">
        <h1 class="title">üéÅ –†–æ–∑—ã–≥—Ä—ã—à Battle Pass</h1>
        <p class="subtitle">–ù–∞–∂–º–∏ ¬´–ö—Ä—É—Ç–∏—Ç—å¬ª ‚Äî –∫–æ–ª–µ—Å–æ –∫—Ä–∞—Å–∏–≤–æ –≤—ã–±–µ—Ä–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.</p>
      </div>

      <div class="wheelWrap">
        <div class="wheelBox">
          <div class="pointer"></div>
          <canvas id="wheel" width="900" height="900"></canvas>
        </div>
      </div>

      <div class="content">
        <div class="row">
          <button id="spinBtn" class="btn primary">–ö—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ</button>
          <button id="reshuffleBtn" class="btn">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å —Ü–≤–µ—Ç–∞</button>
          <span class="hint" id="status">–ì–æ—Ç–æ–≤–æ.</span>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="header">
        <h2 class="title" style="font-size:22px;margin:0 0 6px;">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
        <p class="subtitle">–°–ø–∏—Å–æ–∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —á–µ—Å—Ç–Ω–æ (—Ä–∞–Ω–¥–æ–º) –∏ –∫–æ–ª–µ—Å–æ –¥–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è.</p>
      </div>
      <div class="content">
        <div class="list" id="chips"></div>
        <p class="hint" style="margin-top:14px;">
          –•–æ—Å—Ç–∏–Ω–≥ –±–µ–∑ –¥–æ–º–µ–Ω–∞: GitHub Pages / Cloudflare Pages / Netlify.
        </p>
      </div>
    </div>
  </div>

  <!-- Winner modal -->
  <div class="modal" id="modal">
    <div class="modalCard">
      <button class="closeX" id="closeModal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <div class="badge">üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –≤—ã–±—Ä–∞–Ω</div>
      <div class="winnerName" id="winnerName">‚Äî</div>
      <p class="winnerText" id="winnerText">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ</p>
      <div class="modalActions">
        <button class="btn primary" id="spinAgain">–ö—Ä—É—Ç–∏—Ç—å –µ—â—ë —Ä–∞–∑</button>
        <button class="btn" id="copyWinner">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∏–∫</button>
      </div>
    </div>
  </div>

  <script>
    // ----------------------------
    // Data
    // ----------------------------
    const participants = [
      "LOGAN","Denis","Ricardo-Milo$$$","Postal","Angsar","–§—ë–¥–æ—Ä–æ–≤ –°–µ—Ä–≥–µ–π","Samurai","Vag—ër",
      "–í–∏–∫—Ç–æ—Ä–∏—è","MARSHMALLOWS","–ö–æ—Ç –ë–µ–≥–µ–º–æ—Ç","Golovorez","DenZilla","Laud","kkkk"
    ];

    // Render participant chips
    const chips = document.getElementById('chips');
    participants.forEach(n => {
      const span = document.createElement('span');
      span.className = 'chip';
      span.textContent = n;
      chips.appendChild(span);
    });

    // ----------------------------
    // Wheel drawing
    // ----------------------------
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');

    const W = canvas.width;
    const H = canvas.height;
    const cx = W/2, cy = H/2;
    const radius = Math.min(W, H) * 0.42;

    let angle = Math.random() * Math.PI * 2;
    let paletteSeed = Math.random() * 1000;

    function hsl(i, n){
      // vivid but soft
      const hue = ( (i / n) * 360 + paletteSeed ) % 360;
      return `hsl(${hue} 85% 55%)`;
    }

    function fitLabel(text, maxChars){
      if (text.length <= maxChars) return text;
      return text.slice(0, Math.max(1, maxChars - 1)).trim() + "‚Ä¶";
    }

    function drawWheel(){
      ctx.clearRect(0,0,W,H);

      // shadow + ring
      ctx.save();
      ctx.translate(cx, cy);
      ctx.beginPath();
      ctx.arc(0, 10, radius + 26, 0, Math.PI*2);
      ctx.fillStyle = "rgba(0,0,0,0.55)";
      ctx.fill();
      ctx.restore();

      // outer ring
      ctx.save();
      ctx.translate(cx, cy);
      ctx.beginPath();
      ctx.arc(0, 0, radius + 18, 0, Math.PI*2);
      ctx.fillStyle = "#23283b";
      ctx.fill();
      ctx.beginPath();
      ctx.arc(0, 0, radius + 10, 0, Math.PI*2);
      ctx.fillStyle = "#11162a";
      ctx.fill();
      ctx.restore();

      const n = participants.length;
      const step = (Math.PI*2)/n;

      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(angle);

      for(let i=0;i<n;i++){
        const start = -Math.PI/2 + i*step;
        const end = start + step;

        // sector
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.arc(0,0,radius,start,end);
        ctx.closePath();
        ctx.fillStyle = hsl(i,n);
        ctx.fill();

        ctx.strokeStyle = "rgba(0,0,0,0.25)";
        ctx.lineWidth = 3;
        ctx.stroke();

        // label
        const mid = (start+end)/2;
        ctx.save();
        ctx.rotate(mid);

        const name = participants[i];
        // auto-max chars by radius and name length (simple)
        const label = fitLabel(name, 14);

        ctx.font = "bold 26px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial";
        ctx.fillStyle = "rgba(0,0,0,0.75)";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.translate(radius*0.70, 0);

        // rotate text upright
        ctx.rotate(Math.PI/2);

        ctx.fillText(label, 0, 0);
        ctx.restore();
      }
      ctx.restore();

      // hub
      ctx.save();
      ctx.translate(cx, cy);
      ctx.beginPath();
      ctx.arc(0,0,30,0,Math.PI*2);
      ctx.fillStyle="#0f1324";
      ctx.fill();
      ctx.beginPath();
      ctx.arc(0,0,12,0,Math.PI*2);
      ctx.fillStyle="#f2f4ff";
      ctx.fill();
      ctx.restore();
    }

    drawWheel();

    // ----------------------------
    // Spin logic (fair choice + animate to target)
    // ----------------------------
    const spinBtn = document.getElementById('spinBtn');
    const reshuffleBtn = document.getElementById('reshuffleBtn');
    const statusEl = document.getElementById('status');

    const modal = document.getElementById('modal');
    const winnerName = document.getElementById('winnerName');
    const winnerText = document.getElementById('winnerText');
    const closeModal = document.getElementById('closeModal');
    const spinAgain = document.getElementById('spinAgain');
    const copyWinner = document.getElementById('copyWinner');

    let spinning = false;
    let lastWinner = null;

    function easeOutCubic(t){ return 1 - Math.pow(1-t, 3); }

    function pickWinner(){
      const idx = Math.floor(Math.random() * participants.length);
      return { name: participants[idx], idx };
    }

    function targetAngleForIndex(index){
      // pointer fixed at top (-pi/2). We want the sector center to align under it.
      const n = participants.length;
      const step = (Math.PI*2)/n;

      // Sector i center in wheel coordinates:
      const sectorCenter = (-Math.PI/2) + index*step + step/2;

      // Wheel rotates by 'angle', so final alignment means:
      // sectorCenter + angle == -Math.PI/2  (pointer direction in world before rotate)
      // => angle == -Math.PI/2 - sectorCenter
      const base = (-Math.PI/2) - sectorCenter;

      const turns = 8 + Math.floor(Math.random()*6); // 8..13
      return base + turns * Math.PI * 2;
    }

    function openWinner(name){
      lastWinner = name;
      winnerName.textContent = name;
      winnerText.textContent = "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ –ó–∞–±–∏—Ä–∞–π Battle Pass.";
      modal.classList.add('show');
      startConfetti(1800);
    }

    function closeWinner(){
      modal.classList.remove('show');
    }

    function spin(){
      if (spinning) return;
      spinning = true;
      spinBtn.disabled = true;
      reshuffleBtn.disabled = true;
      statusEl.textContent = "–ö—Ä—É—Ç–∏–º‚Ä¶";

      const { name, idx } = pickWinner();
      const start = angle;
      const end = targetAngleForIndex(idx);

      const duration = 6500; // ms
      const startTime = performance.now();

      function frame(now){
        const t = Math.min(1, (now - startTime)/duration);
        const e = easeOutCubic(t);
        angle = start + (end - start) * e;
        drawWheel();

        if (t < 1){
          requestAnimationFrame(frame);
        } else {
          spinning = false;
          spinBtn.disabled = false;
          reshuffleBtn.disabled = false;
          statusEl.textContent = "–ì–æ—Ç–æ–≤–æ. –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –≤—ã–±—Ä–∞–Ω.";
          openWinner(name);
        }
      }
      requestAnimationFrame(frame);
    }

    spinBtn.addEventListener('click', spin);
    reshuffleBtn.addEventListener('click', () => {
      paletteSeed = Math.random()*1000;
      drawWheel();
    });

    closeModal.addEventListener('click', closeWinner);
    modal.addEventListener('click', (e) => { if(e.target === modal) closeWinner(); });

    spinAgain.addEventListener('click', () => {
      closeWinner();
      spin();
    });

    copyWinner.addEventListener('click', async () => {
      if(!lastWinner) return;
      try{
        await navigator.clipboard.writeText(lastWinner);
        copyWinner.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ";
        setTimeout(() => copyWinner.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∏–∫", 1200);
      }catch{
        copyWinner.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å üòÖ";
        setTimeout(() => copyWinner.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∏–∫", 1200);
      }
    });

    // ----------------------------
    // Confetti (lightweight)
    // ----------------------------
    const conf = document.getElementById('confetti');
    const cctx = conf.getContext('2d');
    let confetti = [];
    let confettiRunning = false;

    function resizeConf(){
      conf.width = window.innerWidth * devicePixelRatio;
      conf.height = window.innerHeight * devicePixelRatio;
    }
    window.addEventListener('resize', resizeConf);
    resizeConf();

    function startConfetti(ms=1500){
      const count = 240;
      confetti = [];
      for(let i=0;i<count;i++){
        confetti.push({
          x: Math.random()*conf.width,
          y: -20 - Math.random()*conf.height*0.3,
          vx: (Math.random()-0.5)*2.2,
          vy: 2 + Math.random()*5.0,
          size: 6 + Math.random()*10,
          rot: Math.random()*Math.PI,
          vr: (Math.random()-0.5)*0.25,
          hue: Math.random()*360
        });
      }
      confettiRunning = true;
      const start = performance.now();

      function tick(now){
        cctx.clearRect(0,0,conf.width,conf.height);
        confetti.forEach(p=>{
          p.x += p.vx * devicePixelRatio;
          p.y += p.vy * devicePixelRatio;
          p.rot += p.vr;

          cctx.save();
          cctx.translate(p.x, p.y);
          cctx.rotate(p.rot);
          cctx.fillStyle = `hsla(${p.hue} 90% 60% / 0.95)`;
          cctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.7);
          cctx.restore();
        });
        confetti = confetti.filter(p => p.y < conf.height + 60);

        if (now - start < ms && confetti.length){
          requestAnimationFrame(tick);
        } else {
          cctx.clearRect(0,0,conf.width,conf.height);
          confettiRunning = false;
        }
      }
      requestAnimationFrame(tick);
    }
  </script>
</body>
</html>
